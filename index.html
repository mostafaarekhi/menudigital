<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Ù…Ù†ÙˆÛŒ Ú©Ø§ÙÙ‡</title>
  <!-- Font -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@300;400;600;700;800;900&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#0f1115; --panel:#141823; --muted:#9aa3b2; --text:#f2f5f9; --brand:#7c4dff;
      --brand-2:#00e5ff; --ok:#31d0aa; --danger:#ff6b6b; --card:#161b27; --border:#222838;
      --shadow: 0 10px 30px rgba(0,0,0,.35);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family:"Vazirmatn", system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
      background: radial-gradient(1200px 600px at 80% -10%, rgba(124,77,255,.12), transparent 60%),
                  radial-gradient(1000px 500px at 0% 120%, rgba(0,229,255,.10), transparent 60%),
                  var(--bg);
      color:var(--text);
    }
    a{color:inherit}
    .container{max-width:1200px; margin:0 auto; padding:16px}
    header{
      position:sticky; top:0; z-index:40; backdrop-filter:saturate(140%) blur(8px);
      background:linear-gradient(180deg, rgba(15,17,21,.85), rgba(15,17,21,.6));
      border-bottom:1px solid var(--border);
    }
    .brand{display:flex; align-items:center; gap:12px; padding:10px 0}
    .logo{width:44px; height:44px; display:grid; place-items:center; border-radius:14px;
          background: linear-gradient(135deg, var(--brand), var(--brand-2));
          color:white; font-weight:900; font-size:20px; box-shadow:var(--shadow)}
    .title{font-weight:900; font-size:22px; letter-spacing:.2px}
    .subtitle{font-size:12px; color:var(--muted)}

    .toolbar{display:flex; gap:8px; align-items:center; flex-wrap:wrap; margin-top:8px}
    .chip{display:inline-flex; align-items:center; gap:8px; padding:10px 12px; border:1px solid var(--border);
          border-radius:12px; background:var(--panel); cursor:pointer; transition:.2s}
    .chip.active, .chip:hover{border-color:var(--brand); box-shadow:0 0 0 2px rgba(124,77,255,.2) inset}
    .chip svg{width:18px; height:18px; opacity:.95}

    .search{flex:1; min-width:220px; position:relative}
    .search input{width:100%; padding:12px 14px; border-radius:12px; border:1px solid var(--border);
                  outline:none; background:var(--panel); color:var(--text)}
    .search .icon{position:absolute; left:10px; top:50%; transform:translateY(-50%); opacity:.7}

    .grid{display:grid; grid-template-columns:repeat(4, 1fr); gap:16px; margin-top:16px}
    @media (max-width:1000px){.grid{grid-template-columns:repeat(3, 1fr)}}
    @media (max-width:760px){.grid{grid-template-columns:repeat(2, 1fr)}}
    @media (max-width:520px){.grid{grid-template-columns:1fr}}

    .card{background:var(--card); border:1px solid var(--border); border-radius:18px; overflow:hidden; box-shadow:var(--shadow); display:flex; flex-direction:column}
    .thumb{position:relative; aspect-ratio:4/3; overflow:hidden; background:#0b0e13}
    .thumb img{width:100%; height:100%; object-fit:cover; display:block}
    .badge{position:absolute; top:10px; right:10px; background:rgba(0,0,0,.55); padding:6px 10px; font-size:12px; border-radius:999px; border:1px solid rgba(255,255,255,.15)}
    .content{padding:12px 14px; display:flex; flex-direction:column; gap:8px}
    .name{font-weight:800}
    .ing{font-size:13px; color:var(--muted); line-height:1.6}
    .meta{display:flex; align-items:center; justify-content:space-between}
    .price{font-weight:900; font-size:16px}

    .qty{display:flex; align-items:center; gap:6px}
    .btn{background:var(--panel); border:1px solid var(--border); color:var(--text); padding:8px 10px; border-radius:10px; cursor:pointer}
    .btn:hover{border-color:var(--brand)}
    .btn.icon{display:grid; place-items:center; width:34px; height:34px}

    /* Drawer */
    .drawer{position:fixed; inset-inline-start:auto; inset-inline-end:0; top:0; bottom:0; width:min(420px, 100%);
            background:linear-gradient(180deg, #0e1218, #0c1116); border-left:1px solid var(--border); box-shadow:var(--shadow); display:flex; flex-direction:column; transform:translateX(100%); transition:.28s ease}
    .drawer.open{transform:translateX(0)}
    .drawer header{position:sticky; top:0; background:transparent; border-bottom:1px solid var(--border)}
    .drawer .head{display:flex; align-items:center; justify-content:space-between; padding:14px 16px}
    .drawer .body{padding:14px 16px; overflow:auto; flex:1}
    .drawer .foot{padding:12px 16px; border-top:1px solid var(--border); display:grid; gap:8px}
    .row{display:flex; align-items:center; justify-content:space-between; gap:8px}
    .note{width:100%; min-height:70px; padding:10px; border:1px solid var(--border); border-radius:12px; background:var(--panel); color:var(--text)}

    .order-item{display:grid; grid-template-columns:auto 1fr auto; gap:10px; align-items:center; border:1px solid var(--border); padding:10px; border-radius:12px; margin-bottom:10px; background:var(--panel)}
    .order-item .thumb{width:64px; aspect-ratio:1; border-radius:10px; overflow:hidden}
    .order-item .thumb img{width:100%; height:100%; object-fit:cover}
    .order-item h4{margin:0 0 4px 0}
    .order-item .muted{font-size:12px; color:var(--muted)}

    .floating-cart{position:fixed; inset-inline-end:16px; bottom:16px; z-index:50}
    .cart-btn{display:flex; align-items:center; gap:10px; padding:12px 16px; border-radius:14px; background:linear-gradient(135deg, var(--brand), var(--brand-2)); color:white; border:none; cursor:pointer; box-shadow:var(--shadow); font-weight:800}
    .cart-count{display:inline-grid; place-items:center; min-width:26px; height:26px; padding:0 6px; background:rgba(0,0,0,.25); border-radius:999px}

    .pill{font-size:12px; padding:6px 10px; border-radius:999px; border:1px solid var(--border); background:var(--panel)}
    .kbd{font-family:ui-monospace, SFMono-Regular, Menlo, monospace; font-size:12px; background:#0b0e13; border:1px solid var(--border); border-radius:6px; padding:2px 6px}
    .muted{color:var(--muted)}

    .hidden{display:none}
  </style>
</head>
<body>
  <!--
    Ø±Ø§Ù‡Ù†Ù…Ø§:
    1) Ù†Ø§Ù… Ú©Ø§ÙÙ‡ Ùˆ Ù„ÙˆÚ¯Ùˆ Ø±Ø§ Ø¯Ø± Ù‡Ø¯Ø± ØªØºÛŒÛŒØ± Ø¯Ù‡ÛŒØ¯. Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Ù„ÙˆÚ¯ÙˆÛŒ ÙˆØ§Ù‚Ø¹ÛŒ Ø±Ø§ Ø¬Ø§ÛŒÚ¯Ø²ÛŒÙ† div.logo Ú©Ù†ÛŒØ¯.
    2) Ø¯Ø³ØªÙ‡â€ŒÙ‡Ø§ Ùˆ Ø¢ÛŒØªÙ…â€ŒÙ‡Ø§ Ø¯Ø± Ø¢Ø±Ø§ÛŒÙ‡ Ù‡Ø§ÛŒ categories Ùˆ items Ø¯Ø± Ø§Ù†ØªÙ‡Ø§ÛŒ ÙØ§ÛŒÙ„ JS Ù‡Ø³ØªÙ†Ø¯.
    3) Ø¨Ø±Ø§ÛŒ Ø§Ø³ØªÙ‚Ø±Ø§Ø± Ø¯Ø± GitHub Pages Ú©Ø§ÙÛŒØ³Øª Ø§ÛŒÙ† ÙØ§ÛŒÙ„ Ø±Ø§ Ø¨Ù‡ Ù†Ø§Ù… index.html Ø¯Ø± Ø±ÛŒØ´Ù‡ Ø±ÛŒÙ¾Ùˆ Ù‚Ø±Ø§Ø± Ø¯Ù‡ÛŒØ¯.
    4) Ø¯Ú©Ù…Ù‡ Â«Ù¾Ø±ÛŒÙ†ØªÂ» ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ø³ÙØ§Ø±Ø´ Ø±Ø§ Ø¨Ù‡ ØµÙˆØ±Øª ÙÛŒØ´ Ú©ÙˆÚ†Ú© Ú†Ø§Ù¾ Ù…ÛŒâ€ŒÚ©Ù†Ø¯. Â«Ú©Ù¾ÛŒÂ» Ù…ØªÙ† Ø±Ø§ Ø¯Ø± Ú©Ù„ÛŒÙ¾â€ŒØ¨ÙˆØ±Ø¯ Ù…ÛŒâ€ŒÚ¯Ø°Ø§Ø±Ø¯.
    5) Ø³ÙØ§Ø±Ø´â€ŒÙ‡Ø§ Ø¯Ø± localStorage Ø°Ø®ÛŒØ±Ù‡ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯ ØªØ§ Ø¨Ø§ Ø±ÙØ±Ø´ Ø§Ø² Ø¨ÛŒÙ† Ù†Ø±ÙˆÙ†Ø¯.
  -->

  <header>
    <div class="container">
      <div class="brand">
        <div class="logo" aria-label="Ù„ÙˆÚ¯Ùˆ">â˜•</div>
        <div>
          <div class="title">Ú©Ø§ÙÙ‡ Ù…ÙˆØ³ØªØ§ÙØ§</div>
          <div class="subtitle">Ù…Ù†ÙˆÛŒ ØªØ¹Ø§Ù…Ù„ÛŒ | Ø§Ù†ØªØ®Ø§Ø¨ Ùˆ ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ø³ÙØ§Ø±Ø´</div>
        </div>
      </div>
      <div class="toolbar">
        <div class="search">
          <input id="search" placeholder="Ø¬Ø³ØªØ¬Ùˆ Ø¯Ø± Ù…Ù†Ùˆ (Ù†Ø§Ù…ØŒ Ù…ÙˆØ§Ø¯ ØªØ´Ú©ÛŒÙ„â€ŒØ¯Ù‡Ù†Ø¯Ù‡)" />
          <svg class="icon" width="18" height="18" viewBox="0 0 24 24"><path fill="currentColor" d="M15.5 14h-.79l-.28-.27A6.471 6.471 0 0 0 16 9.5A6.5 6.5 0 1 0 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5S14 7.01 14 9.5S11.99 14 9.5 14"/></svg>
        </div>
        <div id="filters" class="toolbar" aria-label="Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒâ€ŒÙ‡Ø§"></div>
      </div>
    </div>
  </header>

  <main class="container">
    <div id="grid" class="grid"></div>
  </main>

  <!-- Floating Cart Button -->
  <div class="floating-cart">
    <button class="cart-btn" id="openCart">
      <span class="cart-count" id="cartCount">0</span>
      Ø³ÙØ§Ø±Ø´ Ù…ÙˆÙ‚Øª
      <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M7 18c-1.1 0-1.99.9-1.99 2S5.9 22 7 22s2-.9 2-2-.9-2-2-2m10 0c-1.1 0-1.99.9-1.99 2S15.9 22 17 22s2-.9 2-2-.9-2-2-2M7.17 14h9.66c.75 0 1.41-.41 1.75-1.03l3.58-6.49c.37-.66.11-1.49-.55-1.86c-.21-.12-.45-.18-.69-.18H6.21L5.27 2.9C5.1 2.37 4.61 2 4.04 2H2v2h1.6l3.6 10.59c.14.4.52.66.94.66M7 6h13.1l-2.76 5H8.53z"/></svg>
    </button>
  </div>

  <template id="cardTpl">
    <div class="card">
      <div class="thumb"><img alt="" loading="lazy"/></div>
      <span class="badge"></span>
      <div class="content">
        <div class="name"></div>
        <div class="ing"></div>
        <div class="meta">
          <div class="price"></div>
          <div class="qty">
            <button class="btn icon minus">âˆ’</button>
            <span class="count">0</span>
            <button class="btn icon plus">+</button>
          </div>
        </div>
      </div>
    </div>
  </template>

  <script>
    // --- Data --------------------------------------------------------------
    const categories = [
      {id:'coffee-hot', title:'Ù‚Ù‡ÙˆÙ‡â€ŒÙ‡Ø§ÛŒ Ú¯Ø±Ù…', icon:'â˜•'},
      {id:'coffee-cold', title:'Ù†ÙˆØ´ÛŒØ¯Ù†ÛŒâ€ŒÙ‡Ø§ÛŒ Ø³Ø±Ø¯', icon:'ğŸ§Š'},
      {id:'tea', title:'Ú†Ø§ÛŒ Ùˆ Ø¯Ù…Ù†ÙˆØ´', icon:'ğŸµ'},
      {id:'smoothie', title:'Ø§Ø³Ù…ÙˆØªÛŒ', icon:'ğŸ¥¤'},
      {id:'dessert', title:'Ø¯Ø³Ø±', icon:'ğŸ°'},
      {id:'breakfast', title:'ØµØ¨Ø­Ø§Ù†Ù‡', icon:'ğŸ¥'},
      {id:'snack', title:'Ù…ÛŒØ§Ù†â€ŒÙˆØ¹Ø¯Ù‡', icon:'ğŸ¥¨'},
      {id:'sandwich', title:'Ø³Ø§Ù†Ø¯ÙˆÛŒÚ†', icon:'ğŸ¥ª'},
      {id:'salad', title:'Ø³Ø§Ù„Ø§Ø¯', icon:'ğŸ¥—'},
      {id:'pizza', title:'Ù¾ÛŒØªØ²Ø§', icon:'ğŸ•'}
    ];

    const items = [
      // coffee hot
      {id:'espresso', cat:'coffee-hot', name:'Ø§Ø³Ù¾Ø±Ø³Ùˆ Ø³ÛŒÙ†Ú¯Ù„', ing:'Ø¯Ø§Ù†Ù‡ Ø¹Ø±Ø¨ÛŒÚ©Ø§ØŒ Ø¹ØµØ§Ø±Ù‡â€ŒÚ¯ÛŒØ±ÛŒ Û²Ûµâ€“Û³Û° Ø«Ø§Ù†ÛŒÙ‡', price:45000, img:'https://images.unsplash.com/photo-1498804103079-a6351b050096?q=80&w=1200&auto=format&fit=crop'},
      {id:'cappuccino', cat:'coffee-hot', name:'Ú©Ø§Ù¾ÙˆÚ†ÛŒÙ†Ùˆ', ing:'Ø§Ø³Ù¾Ø±Ø³ÙˆØŒ ÙÙˆÙ… Ø´ÛŒØ±ØŒ Ø¯Ø§Ø±Ú†ÛŒÙ†', price:85000, img:'https://images.unsplash.com/photo-1503481766315-7a586b20f66d?q=80&w=1200&auto=format&fit=crop'},
      {id:'latte', cat:'coffee-hot', name:'Ù„Ø§ØªÙ‡', ing:'Ø§Ø³Ù¾Ø±Ø³ÙˆØŒ Ø´ÛŒØ± Ø¨Ø®Ø§Ø± Ø¯Ø§Ø¯Ù‡', price:90000, img:'https://images.unsplash.com/photo-1517705008128-361805f42e86?q=80&w=1200&auto=format&fit=crop'},

      // coffee cold
      {id:'iced-latte', cat:'coffee-cold', name:'Ø¢ÛŒØ³ Ù„Ø§ØªÙ‡', ing:'Ø§Ø³Ù¾Ø±Ø³ÙˆØŒ Ø´ÛŒØ± Ø³Ø±Ø¯ØŒ ÛŒØ®', price:95000, img:'https://images.unsplash.com/photo-1555949963-aa79dcee981d?q=80&w=1200&auto=format&fit=crop'},
      {id:'cold-brew', cat:'coffee-cold', name:'Ú©Ù„Ø¯ Ø¨Ø±Ùˆ', ing:'Ù‚Ù‡ÙˆÙ‡ Ø¯Ù…â€ŒØ³Ø±Ø¯ Û±Û² Ø³Ø§Ø¹ØªÙ‡', price:110000, img:'https://images.unsplash.com/photo-1527515637462-cff94eecc1ac?q=80&w=1200&auto=format&fit=crop'},

      // tea
      {id:'black-tea', cat:'tea', name:'Ú†Ø§ÛŒ Ø³ÛŒØ§Ù‡ Ù…Ù…ØªØ§Ø²', ing:'Ú†Ø§ÛŒ ØªØ§Ø²Ù‡â€ŒØ¯Ù…ØŒ Ù„ÛŒÙ…Ùˆ', price:35000, img:'https://images.unsplash.com/photo-1518977676601-b53f82aba655?q=80&w=1200&auto=format&fit=crop'},
      {id:'herbal', cat:'tea', name:'Ø¯Ù…Ù†ÙˆØ´ Ø¨Ù‡â€ŒÙ„ÛŒÙ…Ùˆ', ing:'Ø¨Ù‡â€ŒÙ„ÛŒÙ…ÙˆØŒ Ú¯Ù„â€ŒÚ¯Ø§ÙˆØ²Ø¨Ø§Ù†ØŒ Ø¹Ø³Ù„', price:60000, img:'https://images.unsplash.com/photo-1544787219-7f47ccb76574?q=80&w=1200&auto=format&fit=crop'},

      // smoothie
      {id:'berry-sm', cat:'smoothie', name:'Ø§Ø³Ù…ÙˆØªÛŒ Ø¨Ø±ÛŒ', ing:'ØªÙˆØªâ€ŒÙØ±Ù†Ú¯ÛŒØŒ Ø¨Ù„ÙˆØ¨Ø±ÛŒØŒ Ù…Ø§Ø³Øª', price:125000, img:'https://images.unsplash.com/photo-1514996937319-344454492b37?q=80&w=1200&auto=format&fit=crop'},
      {id:'mango-sm', cat:'smoothie', name:'Ø§Ø³Ù…ÙˆØªÛŒ Ø§Ù†Ø¨Ù‡', ing:'Ø§Ù†Ø¨Ù‡ ØªØ§Ø²Ù‡ØŒ Ø¢Ø¨ Ù¾Ø±ØªÙ‚Ø§Ù„', price:120000, img:'https://images.unsplash.com/photo-1497534446932-c925b458314e?q=80&w=1200&auto=format&fit=crop'},

      // dessert
      {id:'cheesecake', cat:'dessert', name:'Ú†ÛŒØ²Ú©ÛŒÚ©', ing:'Ù¾Ù†ÛŒØ±Ø®Ø§Ù…Ù‡â€ŒØ§ÛŒØŒ Ø¨ÛŒØ³Ú©ÙˆÛŒØªØŒ Ø³Ø³ ØªÙˆØªâ€ŒÙØ±Ù†Ú¯ÛŒ', price:130000, img:'https://images.unsplash.com/photo-1505253668822-42074d58a7f8?q=80&w=1200&auto=format&fit=crop'},
      {id:'brownie', cat:'dessert', name:'Ø¨Ø±Ø§ÙˆÙ†ÛŒ Ø´Ú©Ù„Ø§ØªÛŒ', ing:'Ø´Ú©Ù„Ø§Øª ØªÙ„Ø®ØŒ Ú¯Ø±Ø¯Ùˆ', price:115000, img:'https://images.unsplash.com/photo-1606313564200-e75d5e30476c?q=80&w=1200&auto=format&fit=crop'},

      // breakfast
      {id:'omelette', cat:'breakfast', name:'Ø§ÙÙ…Ù„Øª Ú¯ÙˆØ¬Ù‡', ing:'ØªØ®Ù…â€ŒÙ…Ø±ØºØŒ Ú¯ÙˆØ¬Ù‡ØŒ Ø§Ø¯ÙˆÛŒÙ‡', price:98000, img:'https://images.unsplash.com/photo-1508739826987-b79cd8b7da12?q=80&w=1200&auto=format&fit=crop'},
      {id:'french-toast', cat:'breakfast', name:'ÙØ±Ù†Ú†â€ŒØªÙˆØ³Øª', ing:'Ù†Ø§Ù† ØªØ³ØªØŒ ØªØ®Ù…â€ŒÙ…Ø±ØºØŒ Ø¯Ø§Ø±Ú†ÛŒÙ†ØŒ Ø¹Ø³Ù„', price:120000, img:'https://images.unsplash.com/photo-1525351484163-7529414344d8?q=80&w=1200&auto=format&fit=crop'},

      // snack
      {id:'fries', cat:'snack', name:'Ø³ÛŒØ¨â€ŒØ²Ù…ÛŒÙ†ÛŒ Ø³Ø±Ø®â€ŒÚ©Ø±Ø¯Ù‡', ing:'Ø³Ø³ Ù…Ø®ØµÙˆØµ', price:80000, img:'https://images.unsplash.com/photo-1550547660-d9450f859349?q=80&w=1200&auto=format&fit=crop'},
      {id:'nachos', cat:'snack', name:'Ù†Ø§Ú†ÙˆØ²', ing:'Ú†ÛŒÙ¾Ø³ ØªÙˆØ±ØªÛŒÙ„Ø§ØŒ Ù¾Ù†ÛŒØ±ØŒ Ø³Ø§Ù„Ø³Ø§', price:135000, img:'https://images.unsplash.com/photo-1544025162-d76694265947?q=80&w=1200&auto=format&fit=crop'},

      // sandwich
      {id:'chicken-sand', cat:'sandwich', name:'Ø³Ø§Ù†Ø¯ÙˆÛŒÚ† Ù…Ø±Øº Ú¯Ø±ÛŒÙ„', ing:'Ù…Ø±Øº Ú¯Ø±ÛŒÙ„ØŒ Ú©Ø§Ù‡ÙˆØŒ Ø³Ø³ Ø³Ø²Ø§Ø±', price:160000, img:'https://images.unsplash.com/photo-1540713434306-58505cf1b6fc?q=80&w=1200&auto=format&fit=crop'},
      {id:'club', cat:'sandwich', name:'Ú©Ù„Ø§Ø¨â€ŒØ³Ù†Ø¯ÙˆÛŒÚ†', ing:'Ú˜Ø§Ù…Ø¨ÙˆÙ†ØŒ Ù¾Ù†ÛŒØ±ØŒ Ú©Ø§Ù‡ÙˆØŒ Ú¯ÙˆØ¬Ù‡', price:170000, img:'https://images.unsplash.com/photo-1544025162-8e8c9f55b03c?q=80&w=1200&auto=format&fit=crop'},

      // salad
      {id:'caesar', cat:'salad', name:'Ø³Ø§Ù„Ø§Ø¯ Ø³Ø²Ø§Ø±', ing:'Ú©Ø§Ù‡Ùˆ Ø±ÙˆÙ…ÛŒØŒ Ú©Ø±ØªÙˆÙ†ØŒ Ù…Ø±ØºØŒ Ù¾Ù†ÛŒØ± Ù¾Ø§Ø±Ù…Ø²Ø§Ù†', price:150000, img:'https://images.unsplash.com/photo-1551183053-bf91a1d81141?q=80&w=1200&auto=format&fit=crop'},
      {id:'greek', cat:'salad', name:'Ø³Ø§Ù„Ø§Ø¯ ÛŒÙˆÙ†Ø§Ù†ÛŒ', ing:'Ø®ÛŒØ§Ø±ØŒ Ú¯ÙˆØ¬Ù‡ØŒ Ø²ÛŒØªÙˆÙ†ØŒ Ù¾Ù†ÛŒØ± ÙØªØ§', price:145000, img:'https://images.unsplash.com/photo-1540420773420-3366772f4999?q=80&w=1200&auto=format&fit=crop'},

      // pizza
      {id:'margherita', cat:'pizza', name:'Ù¾ÛŒØªØ²Ø§ Ù…Ø§Ø±Ú¯Ø§Ø±ÛŒØªØ§', ing:'Ú¯ÙˆØ¬Ù‡ØŒ Ù…ÙˆØ²Ø§Ø±Ù„Ø§ØŒ Ø±ÛŒØ­Ø§Ù†', price:210000, img:'https://images.unsplash.com/photo-1548365328-9f547fb0953c?q=80&w=1200&auto=format&fit=crop'},
      {id:'pepperoni', cat:'pizza', name:'Ù¾Ù¾Ø±ÙˆÙ†ÛŒ', ing:'Ù¾Ù¾Ø±ÙˆÙ†ÛŒØŒ Ù¾Ù†ÛŒØ±ØŒ Ø³Ø³', price:235000, img:'https://images.unsplash.com/photo-1542281286-9e0a16bb7366?q=80&w=1200&auto=format&fit=crop'}
    ];

    // --- State -------------------------------------------------------------
    const state = {
      filter:'all',
      q:'',
      cart:{} // id -> {qty, note}
    };

    // --- Helpers -----------------------------------------------------------
    const toman = n => n.toLocaleString('fa-IR');
    const el = sel => document.querySelector(sel);
    const byId = id => document.getElementById(id);

    function persist(){ localStorage.setItem('cafe-cart', JSON.stringify(state.cart)); }
    function loadPersist(){ try{ state.cart = JSON.parse(localStorage.getItem('cafe-cart'))||{} }catch{ state.cart={} }
      renderCartBadge(); }

    // --- UI: Filters -------------------------------------------------------
    function renderFilters(){
      const wrap = byId('filters');
      wrap.innerHTML = '';
      const all = document.createElement('button');
      all.className = 'chip' + (state.filter==='all' ? ' active' : '');
      all.innerHTML = 'Ù‡Ù…Ù‡';
      all.onclick = ()=>{ state.filter='all'; renderGrid(); highlightFilter(); };
      wrap.appendChild(all);
      categories.forEach(c=>{
        const b = document.createElement('button');
        b.className = 'chip' + (state.filter===c.id ? ' active' : '');
        b.innerHTML = `<span>${c.icon}</span><span>${c.title}</span>`;
        b.onclick = ()=>{ state.filter=c.id; renderGrid(); highlightFilter(); };
        wrap.appendChild(b);
      })
    }
    function highlightFilter(){
      [...document.querySelectorAll('#filters .chip')].forEach(btn=>btn.classList.remove('active'));
      const idx = ['all', ...categories.map(c=>c.id)].indexOf(state.filter);
      const target = document.querySelectorAll('#filters .chip')[idx];
      if(target) target.classList.add('active');
    }

    // --- UI: Grid ----------------------------------------------------------
    function filteredItems(){
      return items.filter(it=> (state.filter==='all' || it.cat===state.filter) &&
        (state.q==='' || it.name.includes(state.q) || it.ing.includes(state.q)));
    }

    function renderGrid(){
      const grid = byId('grid');
      grid.innerHTML = '';
      const list = filteredItems();
      if(!list.length){ grid.innerHTML = `<div class="pill">Ù…ÙˆØ±Ø¯ÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯.</div>`; return; }
      list.forEach(it=> grid.appendChild(renderCard(it)));
    }

    function renderCard(it){
      const tpl = byId('cardTpl');
      const node = tpl.content.firstElementChild.cloneNode(true);
      node.querySelector('.thumb img').src = it.img;
      node.querySelector('.thumb img').alt = it.name;
      node.querySelector('.badge').textContent = categories.find(c=>c.id===it.cat)?.title || '';
      node.querySelector('.name').textContent = it.name;
      node.querySelector('.ing').textContent = it.ing;
      node.querySelector('.price').innerHTML = `${toman(it.price)} <span class="muted">ØªÙˆÙ…Ø§Ù†</span>`;

      const count = node.querySelector('.count');
      const qty = state.cart[it.id]?.qty || 0;
      count.textContent = qty;
      node.querySelector('.minus').onclick = ()=> changeQty(it.id, -1, it);
      node.querySelector('.plus').onclick = ()=> changeQty(it.id, +1, it);

      return node;
    }

    function changeQty(id, delta, it){
      const cur = state.cart[id]?.qty || 0;
      const next = Math.max(0, cur + delta);
      if(next===0){ delete state.cart[id]; }
      else{ state.cart[id] = { ...(state.cart[id]||{}), qty: next, name: it.name, price: it.price, img: it.img, cat: it.cat } }
      renderGrid(); renderDrawer(); renderCartBadge(); persist();
    }

    function renderCartBadge(){
      const totalQty = Object.values(state.cart).reduce((s,v)=>s+v.qty,0);
      byId('cartCount').textContent = totalQty;
      byId('grandTotal').textContent = toman(calcTotal());
    }

    function calcTotal(){
      return Object.values(state.cart).reduce((s,v)=> s + v.qty * v.price, 0);
    }

    // --- Drawer ------------------------------------------------------------
    function toggleDrawer(open){
      const dr = byId('drawer');
      dr.classList[open?'add':'remove']('open');
    }

    function renderDrawer(){
      const list = byId('orderList');
      list.innerHTML = '';
      Object.entries(state.cart).forEach(([id, row])=>{
        const it = items.find(x=>x.id===id) || row;
        const wrap = document.createElement('div');
        wrap.className = 'order-item';
        wrap.innerHTML = `
          <div class="thumb"><img src="${it.img}" alt="${row.name}"></div>
          <div>
            <h4>${row.name}</h4>
            <div class="muted">${categories.find(c=>c.id===row.cat)?.title||''} â€¢ ${toman(row.price)} ØªÙˆÙ…Ø§Ù†</div>
            <div style="margin-top:6px"><input class="note kbd" placeholder="ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ø¢ÛŒØªÙ… (Ù…Ø«Ù„Ø§Ù‹ Ø¨Ø¯ÙˆÙ† Ø´Ú©Ø±)" value="${row.note||''}" style="width:100%"></div>
          </div>
          <div style="display:grid; gap:6px; justify-items:center">
            <div class="qty">
              <button class="btn icon" data-act="minus">âˆ’</button>
              <span class="count">${row.qty}</span>
              <button class="btn icon" data-act="plus">+</button>
            </div>
            <button class="btn" data-act="remove">Ø­Ø°Ù</button>
          </div>
        `;
        // events
        wrap.querySelector('[data-act="minus"]').onclick = ()=> changeQty(id,-1,it);
        wrap.querySelector('[data-act="plus"]').onclick = ()=> changeQty(id,+1,it);
        wrap.querySelector('[data-act="remove"]').onclick = ()=>{ delete state.cart[id]; renderGrid(); renderDrawer(); renderCartBadge(); persist(); };
        wrap.querySelector('input.note').oninput = (e)=>{ state.cart[id].note = e.target.value; persist(); };
        list.appendChild(wrap);
      });
      byId('grandTotal').textContent = toman(calcTotal());
    }

    function buildTextNote(){
      const table = byId('tableNo').value?.trim();
      const lines = [];
      if(table) lines.push(`Ù…ÛŒØ²/Ù…Ø´ØªØ±ÛŒ: ${table}`);
      lines.push('Ø³ÙØ§Ø±Ø´:');
      Object.values(state.cart).forEach(row=>{
        const base = `â€¢ ${row.name} Ã— ${row.qty} â€” ${toman(row.price*row.qty)} ØªÙˆÙ…Ø§Ù†`;
        lines.push(base);
        if(row.note) lines.push(`  â—¦ ÛŒØ§Ø¯Ø¯Ø§Ø´Øª: ${row.note}`);
      });
      lines.push(`Ø¬Ù…Ø¹ Ú©Ù„: ${toman(calcTotal())} ØªÙˆÙ…Ø§Ù†`);
      const note = byId('orderNote').value?.trim();
      if(note) lines.push(`ØªÙˆØ¶ÛŒØ­Ø§Øª Ú©Ù„ÛŒ: ${note}`);
      lines.push('\nâ€” ØªÙˆÙ„ÛŒØ¯ Ø´Ø¯Ù‡ ØªÙˆØ³Ø· Ù…Ù†ÙˆÛŒ Ú©Ø§ÙÙ‡');
      return lines.join('\n');
    }

    function doCopy(){
      const text = buildTextNote();
      navigator.clipboard.writeText(text).then(()=>{
        alert('Ù…ØªÙ† Ø³ÙØ§Ø±Ø´ Ú©Ù¾ÛŒ Ø´Ø¯.');
      }).catch(()=>{
        prompt('Ú©Ù¾ÛŒ Ø¯Ø³ØªÛŒ: Ù…ØªÙ† Ø²ÛŒØ± Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ùˆ Ú©Ù¾ÛŒ Ú©Ù†ÛŒØ¯:', text);
      });
    }

    function doPrint(){
      const text = buildTextNote().replaceAll('\n','<br/>');
      const w = window.open('', 'PRINT', 'height=600,width=420');
      w.document.write(`<!doctype html><html dir="rtl"><head><title>ÙÛŒØ´ Ø³ÙØ§Ø±Ø´</title>
        <meta charset="utf-8"><style>body{font-family:Vazirmatn, sans-serif; padding:14px} .muted{color:#666}
        @media print{ @page{size:80mm auto; margin:6mm} body{font-size:13px} }
        </style></head><body>${text}</body></html>`);
      w.document.close();
      w.focus();
      w.print();
      w.close();
    }

    // --- Events ------------------------------------------------------------
    byId('search').addEventListener('input', (e)=>{ state.q = e.target.value.trim(); renderGrid(); });
    byId('openCart').onclick = ()=>{ renderDrawer(); toggleDrawer(true); };
    byId('closeDrawer').onclick = ()=> toggleDrawer(false);
    byId('clearCart').onclick = ()=>{ if(confirm('Ù‡Ù…Ù‡ Ø¢ÛŒØªÙ…â€ŒÙ‡Ø§ Ø­Ø°Ù Ø´ÙˆÙ†Ø¯ØŸ')){ state.cart={}; renderGrid(); renderDrawer(); renderCartBadge(); persist(); }};
    byId('copyText').onclick = doCopy;
    byId('printSlip').onclick = doPrint;
    byId('saveCart').onclick = ()=>{ persist(); alert('Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯. Ø¯Ø± Ù‡Ù…ÛŒÙ† Ù…Ø±ÙˆØ±Ú¯Ø± Ø¨Ø§Ù‚ÛŒ Ù…ÛŒâ€ŒÙ…Ø§Ù†Ø¯.'); };

    // --- Init --------------------------------------------------------------
    renderFilters();
    loadPersist();
    renderGrid();
  </script>
</body>
</html>
